(()=>{"use strict";const e={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},t=document.querySelector("#card"),o=e=>{[...e].forEach((e=>{e.removeAttribute("disabled","disabled")}))},r=document.querySelector("#success"),n=document.querySelector("#error"),s=(e,t)=>{const o=("success"===e?r:n).cloneNode(!0).content.querySelector(`.${e}`),s=()=>{document.body.removeChild(o),document.removeEventListener("click",s),document.removeEventListener("keydown",c)},c=e=>{27===e.keyCode&&(document.body.removeChild(o),document.removeEventListener("keydown",c),document.removeEventListener("click",s))},a=o.querySelector(`.${e}__message`);if(t){const r=o.querySelector(`.${e}__button`);r.onclick=()=>{document.body.removeChild(o)},a.textContent=t,r.textContent="Закрыть"}o.style.zIndex=1e3,document.body.appendChild(o),document.addEventListener("click",s),document.addEventListener("keydown",c)},c=["gif","jpg","jpeg","png"],a=document.querySelector(".ad-form__field input[type=file]"),i=document.querySelector(".ad-form-header__preview img"),d=document.querySelector(".ad-form__upload input[type=file]"),l=document.querySelector(".ad-form__photo"),u=document.createElement("ul");u.setAttribute("style","list-style:none; display:flex; margin:0; padding:0; width: 261px; flex-wrap: wrap;"),l.appendChild(u),a.addEventListener("change",(()=>{const e=a.files[0],t=e.name.toLowerCase();if(c.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{i.src=t.result})),t.readAsDataURL(e)}})),d.addEventListener("change",(()=>{const e=d.files[0],t=e.name.toLowerCase();if(c.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("li");u.appendChild(e);const o=document.createElement("img");e.appendChild(o),o.setAttribute("src","true"),o.setAttribute("width","70"),o.setAttribute("height","70"),o.setAttribute("alt","Фотография жилья"),o.src=t.result})),t.readAsDataURL(e)}}));const p=u.children,f=document.querySelector("#address"),m=document.querySelector(".ad-form"),y=m.children,h={flat:1e3,bungalow:0,house:5e3,palace:1e4},g={1:[1],2:[1,2],3:[1,2,3],100:[0]},v=document.querySelector("#type"),q=document.querySelector("#price"),S=document.querySelector("#timein"),b=document.querySelector("#timeout"),E=m.querySelector("#title"),x=m.querySelector("#room_number"),k=document.querySelector("#capacity");q.placeholder=1e3,k.value=g[1],q.setAttribute("max",1e6),q.setAttribute("min",h.flat),E.setAttribute("required","required"),E.setAttribute("minlength",30),E.setAttribute("maxlength",100),q.setAttribute("required","required");const w=()=>{var e;R.reset(),O(H),B.setLatLng([j,F]),V.setView({lat:j,lng:F},9),V.closePopup(),e=p,[...e].forEach((e=>{e.remove()})),i.src="img/muffin-grey.svg"},A=()=>{const e=x.value,t=g[e],o=k.querySelectorAll("option");k.value=t[0],o.forEach((e=>{const o=t.findIndex((t=>t===+e.value));e.removeAttribute("disabled"),-1===o&&e.setAttribute("disabled","disabled")}))};A(),f.setAttribute("readonly","true");const C=(e,t)=>{f.value=`${e}, ${t}`},$=()=>{s("success"),m.reset(),C(j,F),w()},T=()=>{s("error")};m.addEventListener("submit",(e=>{var t,o,r;e.preventDefault(),t=new FormData(e.target),o=$,r=T,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t,"Content-Type":"multipart/form-data"}).then((e=>{e.ok?o():r()})).catch((()=>{r()}))})),m.addEventListener("reset",(()=>{setTimeout((()=>{C(j,F),k.value=g[1],q.placeholder=1e3}),0)})),v.addEventListener("change",(()=>{const e=v.value,t=h[e];q.placeholder=t,q.setAttribute("min",t)})),S.addEventListener("change",(()=>{b.value=S.value})),b.addEventListener("change",(()=>{S.value=b.value})),x.addEventListener("change",A);const j=35.6895,F=139.69171,z=[40,40],D=[20,40],R=document.querySelector(".map__filters"),U=R.children,M=[],O=o=>{o.forEach((o=>{const r=L.icon({iconUrl:"./img/pin.svg",iconSize:z,iconAnchor:D}),n=L.marker({lat:o.location.lat,lng:o.location.lng},{icon:r});M.push(n),n.addTo(V).bindPopup((o=>{const r=t.cloneNode(!0).content.querySelector(".popup"),n=r.querySelector(".popup__title"),s=r.querySelector(".popup__text--address"),c=r.querySelector(".popup__text--price"),a=r.querySelector(".popup__type"),i=r.querySelector(".popup__text--capacity"),d=r.querySelector(".popup__text--time"),l=r.querySelector(".popup__description"),u=r.querySelector(".popup__avatar"),p=r.querySelector(".popup__features"),f=r.querySelector(".popup__photos"),m=f.querySelector(".popup__photo"),y=m.height,h=m.width;if(o.offer.title?n.textContent=o.offer.title:n.style.display="none",o.offer.address?s.textContent=o.offer.address:s.style.display="none",o.offer.price?c.textContent=`${o.offer.price} ₽/ночь`:c.style.display="none",o.offer.type?a.textContent=e[o.offer.type]:a.style.display="none",o.offer.rooms&&o.offer.guests?i.textContent=`${o.offer.rooms} комнаты для ${o.offer.guests} гостей`:i.style.display="none",o.offer.checkin&&o.offer.checkout?d.textContent=`Заезд после ${o.offer.checkin}, выезд до ${o.offer.checkout}`:d.style.display="none",o.offer.features.length){const e=p;e.innerHTML="",o.offer.features.forEach((t=>{const o=document.createElement("li");o.classList.add("popup__feature"),o.classList.add(`popup__feature--${t}`),e.appendChild(o)}))}else p.style.display="none";if(o.offer.description?l.textContent=o.offer.description:l.style.display="none",o.offer.photos.length){const e=f;e.innerHTML="",o.offer.photos.forEach((t=>{const o=document.createElement("img");o.classList.add("popup__photo"),o.src=t,o.height=y,o.width=h,o.alt="Фотография жилья",e.appendChild(o)}))}else f.style.display="none";return o.author.avatar?u.src=o.author.avatar:u.style.display="none",r})(o))}))};var P;P=U,[...P].forEach((e=>{e.setAttribute("disabled","disabled")}));let H=null;const I=e=>{H=e,H.length=10,O(e)},N=()=>{s("error","Произошла ошибка запроса при загрузке данных с сервера")},V=L.map("map-canvas").on("load",(()=>{var e,t;m.classList.remove("ad-form--disabled"),o(y),e=I,t=N,fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t()})),o(U)})).setView({lat:j,lng:F},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(V);const W=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[50,50],iconAnchor:[25,50]}),B=L.marker({lat:j,lng:F},{draggable:!0,icon:W});B.addTo(V),B.on("moveend",(e=>{const{lat:t,lng:o}=e.target.getLatLng();C(t.toFixed(5),o.toFixed(5))})),C(j,F);const G="any",J=R.querySelector("#housing-type"),K=R.querySelector("#housing-price"),Q=R.querySelector("#housing-rooms"),X=R.querySelector("#housing-guests"),Y=R.querySelector("#housing-features"),Z=document.querySelector(".ad-form__reset"),ee=_.debounce((()=>{M.forEach((e=>e.remove()));const e=oe();O(e)}),500),te={type:G,price:G,rooms:G,guests:G,features:[]},oe=()=>H.filter((function(e){const t=e.offer.type===te.type||te.type===G,o=e.offer.rooms===+te.rooms||te.rooms===G,r=e.offer.guests===+te.guests||te.guests===G,n=te.price===G||"high"===te.price&&e.offer.price<=1e4||"middle"===te.price&&e.offer.price>=1e4&&e.offer.price<=5e4||"low"===te.price&&e.offer.price>=5e4,s=(c=e.offer.features,te.features.every((a=0,e=>a=c.indexOf(e,a)+1)));var c,a;if(t&&o&&r&&n&&s)return!0}));J.addEventListener("change",(()=>{const e=J.value;te.type=e,ee()})),K.addEventListener("change",(()=>{const e=K.value;te.price=e,ee()})),Q.addEventListener("change",(()=>{const e=Q.value;te.rooms=e,ee()})),X.addEventListener("change",(()=>{const e=X.value;te.guests=e,ee()})),Y.addEventListener("change",(()=>{const e=Y.querySelectorAll("input:checked");te.features=[],e.forEach((e=>{te.features.push(e.value)})),ee()})),Z.addEventListener("click",(()=>{w()}))})();
//# sourceMappingURL=main.bundle.js.map