{"version":3,"sources":["webpack://keksobooking/./source/js/card.js","webpack://keksobooking/./source/js/util.js","webpack://keksobooking/./source/js/message.js","webpack://keksobooking/./source/js/avatar.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/api.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/filter.js"],"names":["mapTypeToHeader","flat","bungalow","house","palace","card","document","querySelector","enableFormElements","elements","forEach","element","removeAttribute","successTemplate","errorTemplate","createMessage","className","textMessage","cloneMessage","cloneNode","content","onClickMessageRemove","body","removeChild","removeEventListener","onEscapeMessageRemove","evt","keyCode","errorTitle","errorButton","onclick","textContent","style","zIndex","appendChild","addEventListener","FILE_TYPES","fileChooser","avatarPreview","housePhotoFileChooser","housePhotoPreview","listHousePhotos","createElement","setAttribute","file","files","fileName","name","toLowerCase","some","it","endsWith","reader","FileReader","src","result","readAsDataURL","unitHousePhoto","pictureHousePhoto","childrenListPhotos","children","coordinateAdress","adForm","adFormFieldsetArray","mapTypePrice","mapRoomNumber","1","2","3","100","allTypeHouse","inputPrice","inputTimeIn","inputTimeOut","inputTitle","roomNumber","capacityGuests","placeholder","value","resetFiltersMap","mapFilters","reset","drawPin","data","mainPinMarker","setLatLng","LAT_TOKYO","LNG_TOKYO","map","setView","lat","lng","closePopup","remove","calcRoomCapacity","selectedRoomNumber","allowedGuests","allOptions","querySelectorAll","option","index","findIndex","el","setAddressValue","onFormSubmitSuccess","onFormSubmitError","formData","onSuccess","onFail","preventDefault","FormData","target","fetch","method","then","response","ok","catch","setTimeout","selectedTypeHouse","priceHome","PIN_ICON_SIZE","PIN_ICON_ANCHOR","mapFiltersFieldsetArray","markersDb","ads","similarAd","pinIcon","L","icon","iconUrl","iconSize","iconAnchor","marker","location","push","addTo","bindPopup","cloneCard","popupTitle","popupTextAddress","popupTextPrice","popupType","popupTextCapacity","popupTextTime","popupDescription","popupAvatar","popupFeatures","popupPhotos","popupPhoto","heightPhoto","height","widthPhoto","width","offer","title","display","address","price","type","rooms","guests","checkin","checkout","features","length","featuresContainer","innerHTML","itemFeature","classList","add","description","photos","photosContainer","itemPhoto","alt","author","avatar","createCard","getDataSuccess","getDataError","on","json","tileLayer","attribution","mainPinIcon","draggable","getLatLng","toFixed","DEFAULT_FILTER_VALUE","housingTypeSelect","housingPriceSelect","housingRoomsSelect","housingGuestsSelect","housingFeaturesInput","resetButton","showFiltredAds","_","debounce","filteredAds","filterAds","filterState","filter","filteredByType","filteredByRooms","filteredByGuests","filteredByPrice","filteredByFeautes","master","every","i","v","indexOf","housingTypeValue","housingPriceValue","housingRoomsValue","housingGuestsValue","checkboxesInput","checkbox"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const mapTypeToHeader = {\n  flat: 'Квартира',\n  bungalow: 'Бунгало',\n  house: 'Дом',\n  palace: 'Дворец',\n};\n\nconst card = document.querySelector('#card');\nconst createCard = (data) => {\n  const cloneCard = card.cloneNode(true).content.querySelector('.popup');\n  const popupTitle = cloneCard.querySelector('.popup__title');\n  const popupTextAddress = cloneCard.querySelector('.popup__text--address');\n  const popupTextPrice = cloneCard.querySelector('.popup__text--price');\n  const popupType = cloneCard.querySelector('.popup__type');\n  const popupTextCapacity = cloneCard.querySelector('.popup__text--capacity');\n  const popupTextTime = cloneCard.querySelector('.popup__text--time');\n  const popupDescription = cloneCard.querySelector('.popup__description');\n  const popupAvatar = cloneCard.querySelector('.popup__avatar');\n  const popupFeatures = cloneCard.querySelector('.popup__features');\n  const popupPhotos = cloneCard.querySelector('.popup__photos');\n  const popupPhoto = popupPhotos.querySelector('.popup__photo');\n\n  const heightPhoto = popupPhoto.height;\n  const widthPhoto = popupPhoto.width;\n\n\n  if (data.offer.title) {\n    popupTitle.textContent = data.offer.title;\n  } else {\n    popupTitle.style.display = 'none';\n  }\n\n  if (data.offer.address) {\n    popupTextAddress.textContent = data.offer.address;\n  } else {\n    popupTextAddress.style.display = 'none';\n  }\n\n  if (data.offer.price) {\n    popupTextPrice.textContent = `${data.offer.price} ₽/ночь`;\n  } else {\n    popupTextPrice.style.display = 'none';\n  }\n\n  if (data.offer.type) {\n    popupType.textContent = mapTypeToHeader[data.offer.type];\n  } else {\n    popupType.style.display = 'none';\n  }\n\n  if (data.offer.rooms && data.offer.guests) {\n    popupTextCapacity.textContent = `${data.offer.rooms} комнаты для ${data.offer.guests} гостей`;\n  } else {\n    popupTextCapacity.style.display = 'none';\n  }\n\n  if (data.offer.checkin && data.offer.checkout) {\n    popupTextTime.textContent = `Заезд после ${data.offer.checkin}, выезд до ${data.offer.checkout}`;\n  } else {\n    popupTextTime.style.display = 'none';\n  }\n\n  if (!data.offer.features.length) {\n    popupFeatures.style.display = 'none';\n  } else {\n    const featuresContainer = popupFeatures;\n    featuresContainer.innerHTML = '';\n    data.offer.features.forEach(element => {\n      const itemFeature = document.createElement('li');\n      itemFeature.classList.add('popup__feature');\n      itemFeature.classList.add(`popup__feature--${element}`);\n      featuresContainer.appendChild(itemFeature);\n    });\n  }\n\n  if (data.offer.description) {\n    popupDescription.textContent = data.offer.description;\n  } else {\n    popupDescription.style.display = 'none';\n  }\n\n  if (!data.offer.photos.length) {\n    popupPhotos.style.display = 'none';\n  } else {\n    const photosContainer = popupPhotos;\n    photosContainer.innerHTML = '';\n    data.offer.photos.forEach(element => {\n      const itemPhoto = document.createElement('img');\n      itemPhoto.classList.add('popup__photo');\n      itemPhoto.src = element;\n      itemPhoto.height = heightPhoto;\n      itemPhoto.width = widthPhoto;\n      itemPhoto.alt = 'Фотография жилья';\n      photosContainer.appendChild(itemPhoto);\n    });\n  }\n\n  if (data.author.avatar) {\n    popupAvatar.src = data.author.avatar;\n  } else {\n    popupAvatar.style.display = 'none';\n  }\n\n  return cloneCard;\n};\n\nexport { createCard };\n","const getRandomNumber = (min, max) => {\n  if (max <= min || max <= 0 || min < 0) {\n    throw new Error('Вcе числа должны быть положительными');\n  }\n  if (typeof min === 'undefined' || typeof max === 'undefined') {\n    throw new Error('Введите все параметры');\n  }\n  if (typeof min !== 'number' || typeof max !== 'number') {\n    throw new Error('Введенные параметры должны быть цифрой');\n  }\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n\nconst getRandomFloatNumber = (min, max, digits) => {\n  if (max <= min || max <= 0 || min <= 0 || digits <= 0) {\n    throw new Error('Вcе числа должны быть положительными');\n  }\n  if (\n    typeof min === 'undefined' ||\n    typeof max === 'undefined' ||\n    typeof digits === 'undefined'\n  ) {\n    throw new Error('Введите все параметры');\n  }\n  if (\n    typeof min !== 'number' ||\n    typeof max !== 'number' ||\n    typeof digits !== 'number'\n  ) {\n    throw new Error('Введенные параметры должны быть цифрой');\n  }\n\n  return +(Math.random() * (max - min) + min).toFixed(digits);\n};\n\nconst getRandomArrayElement = (array) => {\n  return array[getRandomNumber(0, array.length - 1)];\n};\n\nconst createRandomArrayFromArray = (array) => {\n  const result = [];\n  for (let i = 0; i < getRandomNumber(1, array.length); i++) {\n    result.push(array[i]);\n  }\n  return result;\n};\n\nconst enableFormElements = (elements) => {\n  [...elements].forEach(element => {\n    element.removeAttribute('disabled', 'disabled');\n  });\n};\n\n\nconst disableFormElements = (elements) => {\n  [...elements].forEach(element => {\n    element.setAttribute('disabled', 'disabled');\n  });\n};\n\nconst hasSubArray = (master, sub) =>\n  sub.every(((i) => (v) => (i = master.indexOf(v, i) + 1))(0)); // https://stackoverflow.com/a/34152244\n\nexport {\n  getRandomNumber,\n  getRandomFloatNumber,\n  getRandomArrayElement,\n  createRandomArrayFromArray,\n  disableFormElements,\n  enableFormElements,\n  hasSubArray\n};\n","const successTemplate = document.querySelector('#success');\nconst errorTemplate = document.querySelector('#error');\n\nconst createMessage = (className, textMessage) => {\n  const cardMessage = className === 'success' ? successTemplate : errorTemplate;\n  const cloneMessage = cardMessage\n    .cloneNode(true)\n    .content.querySelector(`.${className}`);\n\n  const onClickMessageRemove = () => {\n    document.body.removeChild(cloneMessage);\n    document.removeEventListener('click', onClickMessageRemove);\n    document.removeEventListener('keydown', onEscapeMessageRemove);\n  };\n\n  const onEscapeMessageRemove = (evt) => {\n    if (evt.keyCode === 27) {\n      document.body.removeChild(cloneMessage);\n      document.removeEventListener('keydown', onEscapeMessageRemove);\n      document.removeEventListener('click', onClickMessageRemove);\n    }\n  };\n\n  const errorTitle = cloneMessage.querySelector(`.${className}__message`);\n  if (textMessage) {\n    const errorButton = cloneMessage.querySelector(`.${className}__button`);\n    errorButton.onclick = () => {\n      document.body.removeChild(cloneMessage);\n    };\n    errorTitle.textContent = textMessage;\n    errorButton.textContent = 'Закрыть';\n  }\n  cloneMessage.style.zIndex = 1000;\n  document.body.appendChild(cloneMessage);\n\n  document.addEventListener('click', onClickMessageRemove);\n  document.addEventListener('keydown', onEscapeMessageRemove);\n};\n\nexport { createMessage };\n","const FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png'];\n\nconst fileChooser = document.querySelector('.ad-form__field input[type=file]');\nconst avatarPreview = document.querySelector('.ad-form-header__preview img');\nconst housePhotoFileChooser = document.querySelector(\n  '.ad-form__upload input[type=file]',\n);\nconst housePhotoPreview = document.querySelector('.ad-form__photo');\n\nconst listHousePhotos = document.createElement('ul');\nlistHousePhotos.setAttribute(\n  'style',\n  'list-style:none; display:flex; margin:0; padding:0; width: 261px; flex-wrap: wrap;',\n);\nhousePhotoPreview.appendChild(listHousePhotos);\n\n// Загрузка фото аватара\n\nfileChooser.addEventListener('change', () => {\n  const file = fileChooser.files[0];\n  const fileName = file.name.toLowerCase();\n\n  const matches = FILE_TYPES.some((it) => {\n    return fileName.endsWith(it);\n  });\n\n  if (matches) {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => {\n      avatarPreview.src = reader.result;\n    });\n\n    reader.readAsDataURL(file);\n  }\n});\n\n// Загрузка фото жилья\n\nhousePhotoFileChooser.addEventListener('change', () => {\n  const file = housePhotoFileChooser.files[0];\n  const fileName = file.name.toLowerCase();\n  const matches = FILE_TYPES.some((it) => {\n    return fileName.endsWith(it);\n  });\n\n  if (matches) {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => {\n      const unitHousePhoto = document.createElement('li');\n      listHousePhotos.appendChild(unitHousePhoto);\n\n      const pictureHousePhoto = document.createElement('img');\n      unitHousePhoto.appendChild(pictureHousePhoto);\n      pictureHousePhoto.setAttribute('src', 'true');\n      pictureHousePhoto.setAttribute('width', '85');\n      pictureHousePhoto.setAttribute('height', '85');\n      pictureHousePhoto.setAttribute('alt', 'Фотография жилья');\n      pictureHousePhoto.src = reader.result;\n    });\n\n    reader.readAsDataURL(file);\n  }\n});\n\nexport { listHousePhotos, avatarPreview };\n","import { disableFormElements, enableFormElements } from './util.js';\nimport {\n  LAT_TOKYO,\n  LNG_TOKYO,\n  mapFilters,\n  drawPin,\n  data,\n  mainPinMarker,\n  map\n} from './map.js';\nimport { createMessage } from './message.js';\nimport { sendData } from './api.js';\nimport { listHousePhotos, avatarPreview } from './avatar.js';\n\nconst childrenListPhotos = listHousePhotos.children;\nconst removeChildrenListPhotos = (elements) => {\n  [...elements].forEach((element) => {\n    element.remove();\n  });\n};\n\nconst coordinateAdress = document.querySelector('#address');\nconst adForm = document.querySelector('.ad-form');\nconst adFormFieldsetArray = adForm.children;\n\nconst SEND_DATA_URL = 'https://22.javascript.pages.academy/keksobooking';\nconst MIN_PRICE_FLAT = 1000;\nconst mapTypePrice = {\n  flat: 1000,\n  bungalow: 0,\n  house: 5000,\n  palace: 10000,\n};\nconst mapRoomNumber = {\n  1: [1],\n  2: [1, 2],\n  3: [1, 2, 3],\n  100: [0],\n};\n\nconst MAX_PRICE = 1000000;\nconst MAX_LENGHT_INPUT = 100;\nconst MIN_LENGHT_INPUT = 30;\n\nconst allTypeHouse = document.querySelector('#type');\nconst inputPrice = document.querySelector('#price');\nconst inputTimeIn = document.querySelector('#timein');\nconst inputTimeOut = document.querySelector('#timeout');\nconst inputTitle = adForm.querySelector('#title');\nconst roomNumber = adForm.querySelector('#room_number');\nconst capacityGuests = document.querySelector('#capacity');\n\ninputPrice.placeholder = MIN_PRICE_FLAT;\ncapacityGuests.value = mapRoomNumber['1'];\n\ninputPrice.setAttribute('max', MAX_PRICE);\ninputPrice.setAttribute('min', mapTypePrice.flat);\n\ninputTitle.setAttribute('required', 'required');\ninputTitle.setAttribute('minlength', MIN_LENGHT_INPUT);\ninputTitle.setAttribute('maxlength', MAX_LENGHT_INPUT);\ninputPrice.setAttribute('required', 'required');\n\nconst resetFiltersMap = () => {\n  mapFilters.reset();\n  drawPin(data);\n  mainPinMarker.setLatLng([LAT_TOKYO, LNG_TOKYO]);\n  map.setView(\n    {\n      lat: LAT_TOKYO,\n      lng: LNG_TOKYO,\n    },\n    9,\n  );\n  map.closePopup();\n  removeChildrenListPhotos(childrenListPhotos);\n  avatarPreview.src = 'img/muffin-grey.svg';\n};\n\nconst calcRoomCapacity = () => {\n  const selectedRoomNumber = roomNumber.value;\n  const allowedGuests = mapRoomNumber[selectedRoomNumber];\n  const allOptions = capacityGuests.querySelectorAll('option');\n  capacityGuests.value = allowedGuests[0];\n\n  allOptions.forEach((option) => {\n    const index = allowedGuests.findIndex((el) => el === +option.value);\n    option.removeAttribute('disabled');\n    if (index === -1) {\n      option.setAttribute('disabled', 'disabled');\n    }\n  });\n};\n\ncalcRoomCapacity();\n\ncoordinateAdress.setAttribute('readonly', 'true');\n\nconst deactivateForm = () => {\n  adForm.classList.add('ad-form--disabled');\n  disableFormElements(adFormFieldsetArray);\n};\n\nconst activateForm = () => {\n  adForm.classList.remove('ad-form--disabled');\n  enableFormElements(adFormFieldsetArray);\n};\n\nconst setAddressValue = (lat, lng) => {\n  coordinateAdress.value = `${lat}, ${lng}`;\n};\n\nconst onFormSubmitSuccess = () => {\n  createMessage('success');\n  adForm.reset();\n  setAddressValue(LAT_TOKYO, LNG_TOKYO);\n  resetFiltersMap();\n};\n\nconst onFormSubmitError = () => {\n  createMessage('error');\n};\n\nadForm.addEventListener('submit', (evt) => {\n  evt.preventDefault();\n  const formData = new FormData(evt.target);\n  sendData(SEND_DATA_URL, formData, onFormSubmitSuccess, onFormSubmitError);\n});\n\nadForm.addEventListener('reset', () => {\n  setTimeout(() => {\n    setAddressValue(LAT_TOKYO, LNG_TOKYO);\n    capacityGuests.value = mapRoomNumber['1'];\n    inputPrice.placeholder = MIN_PRICE_FLAT;\n  }, 0);\n});\n\nallTypeHouse.addEventListener('change', () => {\n  const selectedTypeHouse = allTypeHouse.value;\n  const priceHome = mapTypePrice[selectedTypeHouse];\n  inputPrice.placeholder = priceHome;\n  inputPrice.setAttribute('min', priceHome);\n});\n\ninputTimeIn.addEventListener('change', () => {\n  inputTimeOut.value = inputTimeIn.value;\n});\n\ninputTimeOut.addEventListener('change', () => {\n  inputTimeIn.value = inputTimeOut.value;\n});\n\nroomNumber.addEventListener('change', calcRoomCapacity);\n\nexport {\n  coordinateAdress,\n  adForm,\n  adFormFieldsetArray,\n  deactivateForm,\n  activateForm,\n  setAddressValue,\n  resetFiltersMap\n};\n","const sendData = (url, formData, onSuccess, onFail) => {\n  fetch(url, {\n    method: 'POST',\n    body: formData,\n    'Content-Type': 'multipart/form-data',\n  })\n    .then((response) => {\n      if (response.ok) {\n        onSuccess();\n      } else {\n        onFail();\n      }\n    })\n    .catch(() => {\n      onFail();\n    });\n};\n\nconst getData = (url, onSuccess, onFail) => {\n  fetch(url)\n    .then((response) => response.json())\n    .then((ads) => {\n      onSuccess(ads);\n    })\n    .catch(() => {\n      onFail();\n    });\n};\n\nexport { sendData, getData };\n","/* global L:readonly */\n\nimport { createCard } from './card.js';\nimport { setAddressValue } from './form.js';\nimport { disableFormElements } from './util.js';\nimport { activateForm } from './form.js';\nimport { enableFormElements } from './util.js';\nimport { createMessage } from './message.js';\nimport { getData } from './api.js';\n\nconst LAT_TOKYO = 35.6895;\nconst LNG_TOKYO = 139.69171;\nconst GET_DATA_URL = 'https://22.javascript.pages.academy/keksobooking/data';\nconst QUANTITY_ADS = 10;\nconst DIGITS = 5;\nconst PIN_ICON_SIZE = [40, 40];\nconst PIN_ICON_ANCHOR = [20, 40];\nconst MAINPIN_ICON_SIZE = [50, 50];\nconst MAINPIN_ICON_ANCHOR = [25, 50];\n\nconst mapFilters = document.querySelector('.map__filters');\nconst mapFiltersFieldsetArray = mapFilters.children;\n\nconst markersDb = [];\n\n\nconst drawPin = (ads) => {\n  ads.forEach((similarAd) => {\n    const pinIcon = L.icon({\n      iconUrl: './img/pin.svg',\n      iconSize: PIN_ICON_SIZE,\n      iconAnchor: PIN_ICON_ANCHOR,\n    });\n\n    const marker = L.marker(\n      {\n        lat: similarAd.location.lat,\n        lng: similarAd.location.lng,\n      },\n      { icon: pinIcon },\n    );\n    markersDb.push(marker);\n    marker.addTo(map).bindPopup(createCard(similarAd));\n  });\n};\n\ndisableFormElements(mapFiltersFieldsetArray);\n\nlet data = null;\n\nconst getDataSuccess = (ads) => {\n  data = ads;\n  data.length = QUANTITY_ADS;\n  drawPin(ads);\n};\nconst getDataError = () => {\n  createMessage(\n    'error',\n    'Произошла ошибка запроса при загрузке данных с сервера',\n  );\n};\n\nconst map = L.map('map-canvas')\n  .on('load', () => {\n    activateForm();\n    getData(GET_DATA_URL, getDataSuccess, getDataError);\n\n    enableFormElements(mapFiltersFieldsetArray);\n  })\n  .setView(\n    {\n      lat: LAT_TOKYO,\n      lng: LNG_TOKYO,\n    },\n    9,\n  );\n\nL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n  attribution:\n    '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n}).addTo(map);\n\nconst mainPinIcon = L.icon({\n  iconUrl: './img/main-pin.svg',\n  iconSize: MAINPIN_ICON_SIZE,\n  iconAnchor: MAINPIN_ICON_ANCHOR,\n});\n\nconst mainPinMarker = L.marker(\n  {\n    lat: LAT_TOKYO,\n    lng: LNG_TOKYO,\n  },\n  {\n    draggable: true,\n    icon: mainPinIcon,\n  },\n);\n\nmainPinMarker.addTo(map);\n\nmainPinMarker.on('moveend', (evt) => {\n  const { lat, lng } = evt.target.getLatLng();\n  setAddressValue(lat.toFixed(DIGITS), lng.toFixed(DIGITS));\n});\n\nsetAddressValue(LAT_TOKYO, LNG_TOKYO);\n\nexport {\n  LAT_TOKYO,\n  LNG_TOKYO,\n  mapFilters,\n  data,\n  markersDb,\n  drawPin,\n  mainPinMarker,\n  map\n};\n","/* global _:readonly */\n\nimport {\n  mapFilters,\n  data,\n  drawPin,\n  markersDb\n} from './map.js';\nimport { hasSubArray } from './util.js';\nimport { resetFiltersMap } from './form.js';\n\n\nconst DEFAULT_FILTER_VALUE = 'any';\nconst ROOM_MAX_PRICE = 50000;\nconst ROOM_MIN_PRICE = 10000;\nconst HIGH_PRICE = 'high';\nconst MIDDLE_PRICE = 'middle';\nconst LOW_PRICE = 'low';\nconst RERENDER_DELAY = 500;\n\nconst housingTypeSelect = mapFilters.querySelector('#housing-type');\nconst housingPriceSelect = mapFilters.querySelector('#housing-price');\nconst housingRoomsSelect = mapFilters.querySelector('#housing-rooms');\nconst housingGuestsSelect = mapFilters.querySelector('#housing-guests');\nconst housingFeaturesInput = mapFilters.querySelector('#housing-features');\nconst resetButton = document.querySelector('.ad-form__reset');\n\nconst showFiltredAds = _.debounce(() => {\n  markersDb.forEach((marker) => marker.remove());\n  const filteredAds = filterAds();\n  drawPin(filteredAds);\n}, RERENDER_DELAY);\n\nconst filterState = {\n  type: DEFAULT_FILTER_VALUE,\n  price: DEFAULT_FILTER_VALUE,\n  rooms: DEFAULT_FILTER_VALUE,\n  guests: DEFAULT_FILTER_VALUE,\n  features: [],\n};\n\nconst filterAds = () => {\n  return data.filter(function (ads) {\n    const filteredByType =\n      ads.offer.type === filterState.type ||\n      filterState.type === DEFAULT_FILTER_VALUE;\n    const filteredByRooms =\n      ads.offer.rooms === +filterState.rooms ||\n      filterState.rooms === DEFAULT_FILTER_VALUE;\n    const filteredByGuests =\n      ads.offer.guests === +filterState.guests ||\n      filterState.guests === DEFAULT_FILTER_VALUE;\n    const filteredByPrice =\n      filterState.price === DEFAULT_FILTER_VALUE ||\n      (filterState.price === HIGH_PRICE && ads.offer.price <= ROOM_MIN_PRICE) ||\n      (filterState.price === MIDDLE_PRICE &&\n        ads.offer.price >= ROOM_MIN_PRICE &&\n        ads.offer.price <= ROOM_MAX_PRICE) ||\n      (filterState.price === LOW_PRICE && ads.offer.price >= ROOM_MAX_PRICE);\n    const filteredByFeautes = hasSubArray(\n      ads.offer.features,\n      filterState.features,\n    );\n\n    if (\n      filteredByType &&\n      filteredByRooms &&\n      filteredByGuests &&\n      filteredByPrice &&\n      filteredByFeautes\n    ) {\n      return true;\n    }\n  });\n};\n\nhousingTypeSelect.addEventListener('change', () => {\n  const housingTypeValue = housingTypeSelect.value;\n  filterState.type = housingTypeValue;\n\n  showFiltredAds();\n});\n\nhousingPriceSelect.addEventListener('change', () => {\n  const housingPriceValue = housingPriceSelect.value;\n  filterState.price = housingPriceValue;\n\n  showFiltredAds();\n});\n\nhousingRoomsSelect.addEventListener('change', () => {\n  const housingRoomsValue = housingRoomsSelect.value;\n  filterState.rooms = housingRoomsValue;\n\n  showFiltredAds();\n});\n\nhousingGuestsSelect.addEventListener('change', () => {\n  const housingGuestsValue = housingGuestsSelect.value;\n  filterState.guests = housingGuestsValue;\n\n  showFiltredAds();\n});\n\nhousingFeaturesInput.addEventListener('change', () => {\n  const checkboxesInput = housingFeaturesInput.querySelectorAll(\n    'input:checked',\n  );\n  filterState.features = [];\n  checkboxesInput.forEach((checkbox) => {\n    filterState.features.push(checkbox.value);\n  });\n\n  showFiltredAds();\n});\n\nresetButton.addEventListener('click', () => {\n  resetFiltersMap();\n});\n"],"sourceRoot":""}